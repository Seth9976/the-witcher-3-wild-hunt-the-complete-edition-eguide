(function($){$.fn.tablecompare=function(options){var settings=$.extend({animate:false,searchall:false,wraplimit:20,zebra:true,beforefilter:function(){},},options);return this.each(function(){var t=jQuery(this);jQuery(this).find('td p').each(function(){if(jQuery(this).text().length<settings.wraplimit&&jQuery(this).text()==jQuery(this).html())jQuery(this).html(jQuery(this).html().replace(/ /g,'&nbsp;'));});updateZebra(t);t.find('thead th').click(function(){setTimeout(function(){updateZebra(t);},5);});var cols=0;if(jQuery(this).find('thead th').length>0)var colitems=jQuery(this).find('thead th, thead td');else var colitems=jQuery(this).find('tbody tr:first-child td, tbody tr:first-child th');colitems.each(function(){var cs=parseInt(jQuery(this).attr('colspan'));if(cs>1)cols+=cs;else cols+=1;});if(t.hasClass('checklist-table'))cols++;jQuery(this).find('thead').prepend('<tr class="table-options"><td colspan="'+ cols+'"><div><span class="table-compare-text">Compare rows:</span><span class="table-compare-hint">Click to compare <icon class="icon-arrow-right"></icon></span> <a class="button table-compare-done" disabled="disabled"><icon class="icon-indent-right"></icon> Compare</a><a class="button table-compare-button"><icon class="icon-list"></icon> Select</a><a class="button table-compare-reset"><icon class="icon-remove"></icon></a><span class="table-search-wrapper"><input type="text" class="table-search" placeholder="Search table'+(settings.searchall?'s':'')+'..." /><a class="button table-search-reset" disabled="disabled"><icon class="icon-remove"></icon></a></span></div></td></tr>');jQuery(this).prepend('<tfoot class="table-filter-footer"><tr><td colspan="'+cols+'"></td></tr></tfoot>');var table_wrapper=t;if(t.closest('.table-wrapper').length==1)table_wrapper=t.closest('.table-wrapper');if(table_wrapper.prev().filter(':header').length==1){table_wrapper.prev().prependTo(t.find('thead .table-options td'));}
jQuery(this).find('thead th').each(function(){jQuery(this).css('width',jQuery(this).outerWidth()+'px');});jQuery(this).find('tfoot tr td').unbind().click(function(event){var t=jQuery(this).closest('table');t.find('.table-search-reset').click();t.find('.table-compare-reset').click();});jQuery(this).find('.table-search').unbind().keyup(function(event){var s=jQuery(this).val();if(settings.searchall)jQuery('.table-search').val(s);var t=jQuery(this).closest('table');if(settings.searchall)t=jQuery('table');settings.beforefilter(t);t.find('tbody tr').removeClass('row-search-match');if(s.length>0){t.find('tbody td').unhighlight().highlight(s);t.addClass('table-filtered-search');t.find('tbody tr').each(function(){if(jQuery(this).text().toLowerCase().indexOf(s.toLowerCase())>=0)jQuery(this).addClass('row-search-match');});t.find('.table-search-reset').removeAttr('disabled');}
else{t.find('.table-search-reset').click();}
updateZebra(t);updateTableFooters(t);});jQuery(this).find('.table-compare-button').unbind().click(function(event){var t=jQuery(this).closest('table');settings.beforefilter(t);t.toggleClass('table-comparing');if(t.hasClass('table-comparing'))t.removeClass('table-filtered-compare');t.find('tbody tr').unbind().click(function(event){jQuery(this).toggleClass('row-comparing');if(t.find('tbody .row-comparing').length==0)t.find('.table-compare-done').attr('disabled','disabled');else{t.find('.table-compare-done').removeAttr('disabled');t.find('.table-compare-hint').effect("shake",{times:2,distance:3},500);}});});jQuery(this).find('.table-compare-reset').unbind().click(function(event){var t=jQuery(this).closest('table');t.removeClass('table-comparing table-filtered-compare');t.find('tbody tr').removeClass('row-comparing');updateZebra(t);tableTop(t);});jQuery(this).find('.table-search-reset').unbind().click(function(event){var t=jQuery(this).closest('table');if(settings.searchall)t=jQuery('table');t.find('.table-search').val('');t.find('tbody td').unhighlight();t.removeClass('table-filtered-search');t.find('.table-search-reset').attr('disabled','disabled');tableTop(t);});jQuery(this).find('.table-compare-done').unbind().click(function(event){var t=jQuery(this).closest('table');if(t.find('tbody tr.row-comparing').length==0)return;if(settings.animate){t.find('tbody tr:not(.row-comparing)').addClass('row-sliding').children('td').each(function(){if(jQuery(this).children().first().prop("tagName")!='DIV')jQuery(this).wrapInner('<div />');}).children().slideUp('slow',function(){t.find('tbody tr:not(.row-comparing)').removeClass('row-sliding');t.find('tbody tr td div').show();t.removeClass('table-comparing').addClass('table-filtered-compare');updateTableFooters(t);updateZebra(t);});}
else{t.removeClass('table-comparing').addClass('table-filtered-compare');updateTableFooters(t);updateZebra(t);}});});function tableTop(t){var top=t.closest('article').scrollTop()+ t.position().top+ 2;t.closest('article').scrollTop(top);}
function updateTableFooters(t){if(settings.searchall)t=jQuery('table');t.each(function(){var total=jQuery(this).find('tbody tr').length;var visible=jQuery(this).find('tbody tr:visible').length;jQuery(this).find('tfoot tr td').html('Showing '+ visible+' of '+ total+' rows. Show all?');});tableTop(t);}
function updateZebra(t){if(settings.zebra){t.find('tr').removeClass('odd');t.find('tbody tr:visible').each(function(i,row){if(i%2==1)jQuery(row).addClass('odd');});}}};}(jQuery));