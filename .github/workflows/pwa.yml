name: PWA Build and Deploy  
  
on:  
  push:  
    branches: [ main ]  
  pull_request:  
    branches: [ main ]  
  
jobs:  
  build-and-deploy:  
    runs-on: ubuntu-latest  
      
    steps:  
    - name: Checkout  
      uses: actions/checkout@v3  
        
    - name: Setup Node.js  
      uses: actions/setup-node@v3  
      with:  
        node-version: '18'  
          
    - name: Install Workbox  
      run: npm install workbox-cli --global  
        
    - name: Generate Service Worker  
      run: |  
        workbox generateSW workbox-config.js  
          
    - name: Generate Manifest  
      run: |  
        cat > manifest.json << EOF  
        {  
          "name": "The Witcher 3: Wild Hunt Official Digital Strategy Guide",  
          "short_name": "Witcher 3 Guide",  
          "description": "Complete strategy guide for The Witcher 3: Wild Hunt",  
          "start_url": "/",  
          "display": "standalone",  
          "background_color": "#1a1a1a",  
          "theme_color": "#8b0000",  
          "icons": [  
            {  
              "src": "/static/favicon.png",  
              "sizes": "192x192",  
              "type": "image/png"  
            }  
          ]  
        }  
        EOF  
          
    - name: Update HTML files with PWA meta tags  
      run: |  
        find html/ -name "*.html" -exec sed -i '/<head>/a\  
        <link rel="manifest" href="/manifest.json">\  
        <meta name="theme-color" content="#8b0000">\  
        <script>\  
        if ("serviceWorker" in navigator) {\  
          navigator.serviceWorker.register("/sw.js")\  
            .then(registration => console.log("SW registered"))\  
            .catch(error => console.log("SW registration failed"));\  
        }\  
        </script>' {} \;  
